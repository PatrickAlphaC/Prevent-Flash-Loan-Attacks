<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">

<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Prevent Flash Loan Attacks | PreventFlashLoanAttacks</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Prevent Flash Loan Attacks" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="http://localhost:4000/" />
<meta property="og:url" content="http://localhost:4000/" />
<meta property="og:site_name" content="PreventFlashLoanAttacks" />
<script type="application/ld+json">
{"headline":"Prevent Flash Loan Attacks","url":"http://localhost:4000/","name":"PreventFlashLoanAttacks","@type":"WebSite","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <link rel="stylesheet" href="/assets/css/style.css?v=689af63fc96f2fe84baf76b2b65882936ab5eac1">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">PreventFlashLoanAttacks</h1>
      <h2 class="project-tagline"></h2>
      
        <a href="https://github.com/PatrickAlphaC/PreventFlashLoanAttacks" class="btn">View on GitHub</a>
      
      
    </section>

    <section class="main-content">
      <h1 id="prevent-flash-loan-attacks">Prevent Flash Loan Attacks</h1>
<h2 id="purpose">Purpose</h2>

<p>This site is dedicated to information about flash loan attacks (which are usually just <a href="https://blog.chain.link/flash-loans-and-the-importance-of-tamper-proof-oracles/">price oracle attacks</a>) and how to stop them.</p>

<p>For a study done by the Imperial College London, check out this deep dive on the <a href="https://arxiv.org/pdf/2003.03810.pdf">historic bZx flash loan (oracle manipulation) attack</a> for more information.</p>

<p>The first step you can take, is to use <a href="https://docs.chain.link/docs/architecture-decentralized-model">decentralized oracles</a> when working with data, a number of the projects that had issues moved themselves to Chainlink Price Feeds and are now secure.</p>

<h2 id="attacks">Attacks</h2>

<table>
  <thead>
    <tr>
      <th>Protocol</th>
      <th>Reference</th>
      <th>Date</th>
      <th>Value</th>
      <th>Transaction</th>
      <th>Cause</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>bZx (2)</td>
      <td><a href="https://quantstamp.com/blog/10-quick-and-dirty-facts-about-the-bzx-hacks">QuantStamp</a></td>
      <td>Feb-15-2020 01:38:57 AM +UTC</td>
      <td>$800,000</td>
      <td><a href="https://etherscan.io/tx/0x762881b07feb63c436dee38edd4ff1f7a74c33091e534af56c9f7d49b5ecac15">Etherscan</a></td>
      <td>Oracle Attack</td>
    </tr>
    <tr>
      <td>Origin Protocol</td>
      <td><a href="https://www.coindesk.com/origin-protocol-loses-3-25m-in-latest-flash-loan-attack-reports">CoinDesk</a></td>
      <td>Nov-17-2020 12:47:19 AM +UTC</td>
      <td>$7 M</td>
      <td><a href="https://etherscan.io/tx/0xe1c76241dda7c5fcf1988454c621142495640e708e3f8377982f55f8cf2a8401">Etherscan</a></td>
      <td>Re-entrancy Attack</td>
    </tr>
    <tr>
      <td>Harvest.Finance</td>
      <td><a href="https://www.coindesk.com/harvest-finance-24m-attack-triggers-570m-bank-run-in-latest-defi-exploit">CoinDesk</a></td>
      <td>Oct-26-2020 02:58:16 AM +UTC</td>
      <td>$24 M</td>
      <td><a href="https://etherscan.io/tx/0xb460b70f11a93364fecf1f3c3ec49f053aecd2d6d9912c012170aa7a0de2d526">Etherscan</a></td>
      <td>Oracle Attack</td>
    </tr>
    <tr>
      <td>Value Defi</td>
      <td><a href="https://www.coindesk.com/value-defi-suffers-6m-flash-loan-attack">CoinDesk</a></td>
      <td>Nov-14-2020 03:36:30 PM +UTC</td>
      <td>$6 M</td>
      <td><a href="https://etherscan.io/tx/0x46a03488247425f845e444b9c10b52ba3c14927c687d38287c0faddc7471150a">Etherscan</a></td>
      <td>Oracle Attack?</td>
    </tr>
    <tr>
      <td>Akropolis</td>
      <td><a href="https://www.coindesk.com/defi-project-akropolis-token-pool-drained">CoinDesk</a></td>
      <td>Nov-12-2020 12:04:41 PM +UTC</td>
      <td>$2 M</td>
      <td><a href="https://etherscan.io/tx/0xf15623567231c67df2b8bcc5540236fbda2c3ac11ecbec427048f11b582cb869">Etherscan</a></td>
      <td>Oracle Attack?</td>
    </tr>
    <tr>
      <td>Cheese Bank</td>
      <td><a href="https://cointelegraph.com/news/value-defi-protocol-suffers-6-million-flash-loan-exploit">CoinTeleGraph</a></td>
      <td>Nov-14-2020 03:36:30 PM +UTC</td>
      <td>$6 M</td>
      <td><a href="https://etherscan.io/tx/0x46a03488247425f845e444b9c10b52ba3c14927c687d38287c0faddc7471150a">Etherscan</a></td>
      <td>Oracle Attack?</td>
    </tr>
  </tbody>
</table>

<h3 id="malicious-wallets--users">Malicious wallets / Users</h3>

<ul>
  <li><a href="https://etherscan.io/address/0xb77f7bbac3264ae7abc8aedf2ec5f4e7ca079f83">Etherscan</a>, <a href="https://etherscan.io/address/0xf224ab004461540778a914ea397c589b677e27bb">Etherscan</a>, <a href="https://etherscan.io/address/0xa773603b139ae1c52d05b35796df3ee76d8a9a2f">Etherscan</a></li>
</ul>

<h1 id="prevention">Prevention</h1>

<h3 id="issue">Issue</h3>

<p>Let’s take a look at some malicious pseudo-code, pretend these are each ERC20s.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>uint256 priceOfMyGovernanceTokenInETH = dexTokenETHPairPrice;
myGovernanceToken.transfer(msg.sender, priceOfMyGovernanceTokenInETH)
</code></pre></div></div>

<p>This right here should be the easiest red flag on the planet. If you ever do a transfer based on a centralized price oracle, you’re asking to get owned. One way or another.</p>

<h3 id="solution">Solution</h3>

<p>Check the <a href="https://docs.chain.link/docs/get-the-latest-price">Chainlink documentation for decentralized price feeds</a></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="dl">"</span><span class="s2">@chainlink/contracts/src/v0.6/interfaces/AggregatorV3Interface.sol</span><span class="dl">"</span><span class="p">;</span>
<span class="c1">// constructor and getLatestPrice function truncated</span>
<span class="nx">uint256</span> <span class="nx">priceOfMyGovernanceTokenInETH</span> <span class="o">=</span> <span class="nx">getLatestChainlinkPrice</span><span class="p">();</span>
<span class="nx">myGovernanceToken</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">,</span> <span class="nx">priceOfMyGovernanceTokenInETH</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="issue-1">Issue</h3>

<p>Not using safemath.</p>

<h3 id="solution-1">Solution</h3>

<p>Simple, add this to your code.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>using SafeMath for uint256;
</code></pre></div></div>

<h1 id="more-details-notes-threads">More details, notes threads</h1>

<p>This will be a work in progress for us to get better at standards here. At the moment, I’m not sure how to address some of the liquidity issues. If you have a protocol that depends heavily on liquidity of another platform, you could very well be vulnerable.</p>

<p><a href="https://twitter.com/Dogetoshi/status/1326963117356625931">Hack Tweet Thread</a></p>



      <footer class="site-footer">
        
          <span class="site-footer-owner"><a href="https://github.com/PatrickAlphaC/PreventFlashLoanAttacks">PreventFlashLoanAttacks</a> is maintained by <a href="https://github.com/PatrickAlphaC">PatrickAlphaC</a>.</span>
        
        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</span>
      </footer>
    </section>

    
  </body>
</html>
